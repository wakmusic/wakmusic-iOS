#!/bin/sh

FORMAT=$(which swiftformat)

if [[ -e "${FORMAT}" ]]; then
    echo "ğŸš€  SwiftFormat ì‹œì‘..."
    echo "ğŸ”  SwiftFormat ì ìš© ê²½ë¡œ: $(pwd)/Projects"
else
    echo "SwiftFormatì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì„¤ì¹˜í•´ì£¼ì„¸ìš” ! 'brew install swiftformat'"
    exit 1
fi

RESULT=$($FORMAT ./Projects --config .swiftformat)

if [ "$RESULT" == '' ]; then
    git add .
    git commit -m "ğŸ¨ :: ì½”ë“œ Formatting ì ìš©"
    printf "\n ğŸ‰ SwiftFormat ì ìš©ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤ !! \n"
else
    echo ""
    printf "âŒ SwiftFormat Failed ì•„ë˜ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš” \n"
    while read -r line; do
        FILEPATH=$(echo $line | cut -d : -f 1)
        L=$(echo $line | cut -d : -f 2)
      	C=$(echo $line | cut -d : -f 3)
    	TYPE=$(echo $line | cut -d : -f 4 | cut -c 2-)
    	MESSAGE=$(echo $line | cut -d : -f 5 | cut -c 2-)
    	DESCRIPTION=$(echo $line | cut -d : -f 6 | cut -c 2-)
    	if [ $TYPE == 'warning' ]; then
      	    printf "\n ğŸš§  $TYPE\n"
            printf "    $FILEPATH:$L:$C\n"
      	    printf "    ğŸ“Œ  $MESSAGE: - $DESCRIPTION\n"
      	    exit 0
    	elif [ $TYPE == 'error' ]; then
      	    printf "\n ğŸš¨  $TYPE\n"
    	fi
        printf "    âœ… $FILEPATH:$L:$C\n"
	printf "    ğŸ“Œ $MESSAGE: - $DESCRIPTION\n"
    done <<< "$RESULT"

    printf "\n ğŸš‘ ì»¤ë°‹ì‹¤íŒ¨!! SwiftFormat ì‹¤í–‰ì´ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤ ğŸ¥º \n"
    exit 1
fi