name: Caching with Tuist Dependencies

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "*" ]

env:
  CACHED_DEPENDENCY_PATHS: ${{ github.workspace }}/Tuist/Dependencies

jobs:
  caching-dependencies: # job_id = caching-dependencies
    name: ğŸ§© Caching Dependencies
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      - name: Compute dependency cache key
        id: compute_hash
        run: echo "hash=${{ hashFiles('Tuist/Dependencies.swift') }}" >> $GITHUB_OUTPUT 
        # hashFilesëŠ” í•´ë‹¹ íŒŒì¼ì„ í•´ì‹±í•œë‹¤. ì˜ì¡´ì„± ë³€í™”ê°€ ìˆìœ¼ë©´ ìƒˆë¡œìš´ í•´ì‹±ì´ ë“¤ì–´ê° 
        # steps.[step_id].outputs.[ë‹´ì€ë³€ìˆ˜] , ì—¬ê¸°ì„œëŠ”  step_id = compute_hash , [ë‹´ì€ë³€ìˆ˜] = hash

      - name: Check dependency key
        uses: actions/cache@v3 # actionì— ì¡´ì¬í•˜ëŠ” cacheì— ì €ì¥í•¨ 
        id: cache_dependencies
        with:
          path: ${{ env.CACHED_DEPENDENCY_PATHS }} 
          key: ${{ steps.compute_hash.outputs.hash }} 
          
          # pathì— ìˆëŠ” íŒŒì¼ì„ 
          # keyì— ì €ì¥  , ì¡´ì¬ ìœ ë¬´ë¥¼ steps.[step_id].outputs.cache-hit ìœ¼ë¡œ  true or falseë¡œ ë˜ì ¸ì¤Œ

      - name: Install tuist
        if: steps.cache_dependencies.outputs.cache-hit != 'true'  
        run: curl -Ls https://install.tuist.io | bash

        #ifëŠ” í•´ë‹¹ ê°’ì´ trueë©´ ì´ ë™ì‘ì„ ì‹¤í–‰í•˜ê³  falseì´ë©´ ì‹¤í•¼í•˜ì§€ ì•ŠëŠ”ë‹¤.

      - name: Install dependencies
        if: steps.cache_dependencies.outputs.cache-hit != 'true'
        run: tuist fetch

    outputs:
      dependency_cache_key: ${{ steps.compute_hash.outputs.hash }} # ë‹¤ë¥¸ jobì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ 